# AirHome 智能控制系统通信协议的实现
## 项目概述
本项目是一个采用C#语言实现的智能家居控制系统通信协议。其适用于智能控制系统中智能设备模块（如WIFI、ZigBee、蓝牙和红外等）与远程服务器或本地智能设备（如手机、平板电脑、PC等）之间进行数据透明传输，协议定义了消息的功能和通信报文格式。
## 报文格式
为了生成和解析消息具有一致性，并且方便后续扩展新的功能，所有消息数据均采用十六进制形式表示，所有功能指令均进行参数化处理。
### 消息格式定义
消息报文格式的定义由起始符、消息头、消息体和结束符组成，其具体长度随消息体长度的改变而变化。
------------------------------------------------
|        | 起始符 | 消息头  | 消息体 | 结束符  |
|----------------------------------------------|
|  表示  |  STX   |  HEAD   |  BODY  |  ETX    |
|----------------------------------------------|
|  长度  |  1Byte |  12Byte |  可变  |  1Byte  |
|----------------------------------------------|
|  取值  |  0X02  |         |        |  0X03   |
------------------------------------------------
### 转义字符定义
当数据帧起始符和结束符之间（即消息头和消息体中）出现STX，ETX或ESC时，需要进行转义。
* STX转义为ESC和0XE7，即02->1BE7
* ETX转义为ESC和0XE8，即03->1BE8
* ESC转义为ESC和0X00，即1B->1B00
### 消息头定义
消息头的长度总共有12个字节，依次定义了1个字节的消息类型、2个字节的消息体长度、4个字节的消息序号、3个字节的预留字段和2个字节的消息体CRC校验。
---------------------------------------------------------------------------------
|        | 消息类型 | 消息体长度 |      消息序号       |   预留   |  CRC校验    |
|-------------------------------------------------------------------------------|
|  长度  |  1Byte   |  2Byte     |        4Byte        |  3Byte   |   2Byte     |
|-------------------------------------------------------------------------------|
|  取值  |  00~FF   |  0000~FFFF |  00000000~FFFFFFFF  |  000000  |  0000~FFFF  |
|-------------------------------------------------------------------------------|
**消息类型**：表示消息在设备与服务器或APP之间关系。
**消息体长度**：可变消息体所占的字节数。
**消息序号**：取值范围为0~232-1，达到最大值后自动返回从0开始。
**CRC校验**：对消息体的CRC校验，采用CRC16算法。
### 消息体定义
消息体定义了消息ID、设备ID和参数列表，其中参数列表由多个参数依次排列，每个参数由参数类型、参数值长度和参数值组成。消息体的长度由参数值长度及参数个数不同而不固定。
-----------------------------------------------------------------------------
|        |         |         |                   参数列表                   |
|        | 消息ID  | 设备ID  |----------------------------------------------|
|        |         |         | 参数1类型 | 参数1值长度 | 参数1值 | 参数2... |
|---------------------------------------------------------------------------|
|  长度  |  2Byte  |  8Byte  |   2Byte   |    1Byte    |  可变   |          |
|---------------------------------------------------------------------------|
|  取值  |         |         |           |             |         |          |
|---------------------------------------------------------------------------|
**消息ID**：报文消息的代码。
**设备ID**：用于标识设备唯一性的UID，分配方式待定，如果全为0表示广播。兼容其他厂商时，若超过8个字节，取其低（右边）8个字节；若小于8个字节，左边使用0填充。
**参数类型**：参数的类型代码。
**参数值长度**：表示某个参数值的字节数，该值不应超过它的类型规定的最大取值。
**参数值**：长度可变的字符串十六进制表示。